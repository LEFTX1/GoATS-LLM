<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人才搜索结果 - 智能ATS系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #1abc9c;
            --light-bg: #f8f9fa;
            --border-color: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --text-light: #f8f9fa;
            --tag-bg: #e9f7fe;
            --tag-text: #0d6efd;
            --highlight: #fffbea;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.08);
            --hover-shadow: 0 6px 16px rgba(0,0,0,0.12);
        }

        body {
            font-family: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif;
            background-color: #f3f4f6;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .navbar {
            background-color: var(--secondary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            font-weight: 600;
            color: var(--text-light) !important;
        }

        .page-header {
            padding: 2rem 0;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }

        .job-title {
            font-weight: 700;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }

        .stats-container {
            background-color: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 1.5rem;
        }

        .stat-item {
            text-align: center;
            padding: 0.5rem;
            border-right: 1px solid var(--border-color);
        }

        .stat-item:last-child {
            border-right: none;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .resume-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            margin-bottom: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
        }

        .resume-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--hover-shadow);
        }

        .card-header {
            padding: 1.25rem 1.5rem;
            background-color: white;
            border-bottom: 1px solid var(--border-color);
        }

        .candidate-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }

        .file-name {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .badge-container {
            margin-bottom: 0.75rem;
        }

        .experience-badge {
            background-color: #e3f2fd;
            color: #0d6efd;
            font-weight: 500;
        }

        .education-badge {
            background-color: #e8f5e9;
            color: #2e7d32;
            font-weight: 500;
        }

        .school-badge {
            background-color: #fef6e6;
            color: #ff9800;
            font-weight: 500;
        }

        .tag {
            display: inline-block;
            padding: 0.35rem 0.65rem;
            font-size: 0.75rem;
            font-weight: 500;
            background-color: var(--tag-bg);
            color: var(--tag-text);
            border-radius: 4px;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .basic-info {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .info-row {
            display: flex;
            margin-bottom: 0.5rem;
        }

        .info-label {
            flex: 0 0 80px;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .info-value {
            flex: 1;
            font-weight: 500;
        }

        .chunk-container {
            padding: 1rem 1.5rem;
        }

        .chunk {
            margin-bottom: 1.25rem;
            position: relative;
        }

        .chunk:last-child {
            margin-bottom: 0;
        }

        .chunk-title {
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
        }

        .chunk-type {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-left: 0.5rem;
            font-weight: normal;
        }

        .chunk-content {
            white-space: pre-line;
            font-size: 0.9375rem;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .pagination-container {
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        .page-indicator {
            color: var(--text-secondary);
            font-size: 0.9375rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }

        .btn-outline-primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-outline-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .spinner-border {
            color: var(--primary-color);
        }

        .badge-highlight {
            background-color: rgba(255, 193, 7, 0.2);
            color: #ff9800;
            padding: 0.35rem 0.65rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .chunk-icon {
            display: inline-flex;
            width: 24px;
            height: 24px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            margin-right: 0.5rem;
            font-size: 0.75rem;
        }

        .skill-chunk .chunk-icon {
            background-color: #e91e63;
        }

        .work-chunk .chunk-icon {
            background-color: #4caf50;
        }

        .education-chunk .chunk-icon {
            background-color: #ff9800;
        }

        .project-chunk .chunk-icon {
            background-color: #9c27b0;
        }

        .internship-chunk .chunk-icon {
            background-color: #795548;
        }

        .portfolio-chunk .chunk-icon {
            background-color: #009688;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #dee2e6;
        }

        .empty-state h3 {
            font-weight: 500;
            margin-bottom: 1rem;
        }

        footer {
            background-color: var(--secondary-color);
            color: var(--text-light);
            padding: 2rem 0;
            margin-top: 2rem;
        }

        .footer-link {
            color: var(--text-light);
            text-decoration: none;
        }

        .footer-link:hover {
            color: var(--accent-color);
        }

        @media (max-width: 768px) {
            .stat-item {
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                padding: 0.75rem 0;
            }
            
            .stat-item:last-child {
                border-bottom: none;
            }
            
            .card-header {
                padding: 1rem;
            }
            
            .basic-info, .chunk-container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">智能ATS人才系统</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">搜索结果</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">职位管理</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">人才库</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">统计报表</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <header class="page-header">
        <div class="container">
            <h1 class="job-title" id="job-title">高级Go后端及微服务工程师</h1>
            <p class="text-secondary mb-0" id="job-id">职位ID: job-pagination-test-002</p>
        </div>
    </header>

    <main class="container">
        <div class="stats-container">
            <div class="row">
                <div class="col-md-3 stat-item">
                    <div class="stat-value" id="total-resumes">119</div>
                    <div class="stat-label">简历总数</div>
                </div>
                <div class="col-md-3 stat-item">
                    <div class="stat-value" id="current-page">1</div>
                    <div class="stat-label">当前页</div>
                </div>
                <div class="col-md-3 stat-item">
                    <div class="stat-value" id="page-size">10</div>
                    <div class="stat-label">每页简历数</div>
                </div>
                <div class="col-md-3 stat-item">
                    <div class="stat-value" id="total-pages">12</div>
                    <div class="stat-label">总页数</div>
                </div>
            </div>
        </div>

        <div id="resume-container">
            <!-- 简历卡片将在这里动态生成 -->
            <div class="loading">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>

        <div class="pagination-container">
            <div class="page-indicator" id="page-indicator">
                显示第 <span id="start-index">1</span> - <span id="end-index">10</span> 条，共 <span id="total-count">119</span> 条
            </div>
            <div class="d-flex justify-content-center">
                <button id="prev-page" class="btn btn-outline-primary me-2">
                    <i class="bi bi-chevron-left"></i> 上一页
                </button>
                <button id="next-page" class="btn btn-primary">
                    下一页 <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>智能ATS人才系统</h5>
                    <p>基于LLM的简历分析与人才匹配平台</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p>&copy; 2024 智能ATS系统. 保留所有权利。</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 存储所有页数据
        let allPagesData = [];
        
        // 当前页索引
        let currentPageIndex = 0;
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadAllPages();
        });
        
        // 加载所有页面数据
        async function loadAllPages() {
            try {
                // 显示加载中状态
                const container = document.getElementById('resume-container');
                container.innerHTML = `
                    <div class="loading">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">加载中...</span>
                        </div>
                    </div>
                `;
                
                // 并行加载所有JSON文件
                const [page1, page2, page3] = await Promise.all([
                    fetch('paginated_resume_page1.json').then(response => response.json()),
                    fetch('paginated_resume_page2.json').then(response => response.json()),
                    fetch('paginated_resume_page3.json').then(response => response.json())
                ]);
                
                // 存储加载的数据
                allPagesData = [page1, page2, page3];
                
                // 显示第一页数据
                displayResumes(allPagesData[currentPageIndex]);
                updatePaginationControls();
            } catch (error) {
                console.error('加载JSON数据失败:', error);
                const container = document.getElementById('resume-container');
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-exclamation-triangle"></i>
                        <h3>加载数据失败</h3>
                        <p>请检查JSON文件是否存在且格式正确，或者刷新页面重试</p>
                        <p class="text-danger">错误详情: ${error.message}</p>
                    </div>
                `;
            }
        }

        // 显示简历
        function displayResumes(pageData) {
            const container = document.getElementById('resume-container');
            container.innerHTML = ''; // 清空容器

            // 更新页面指标
            document.getElementById('job-id').textContent = `职位ID: ${pageData.job_id}`;
            document.getElementById('total-resumes').textContent = pageData.total_count;
            document.getElementById('current-page').textContent = currentPageIndex + 1;
            document.getElementById('page-size').textContent = pageData.size;
            document.getElementById('total-pages').textContent = Math.ceil(pageData.total_count / pageData.size);
            document.getElementById('start-index').textContent = pageData.cursor + 1;
            document.getElementById('end-index').textContent = Math.min(pageData.cursor + pageData.size, pageData.total_count);
            document.getElementById('total-count').textContent = pageData.total_count;

            // 检查是否有简历数据
            if (!pageData.resumes || pageData.resumes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-file-earmark-x"></i>
                        <h3>没有找到匹配的简历</h3>
                        <p>尝试调整搜索条件或刷新页面</p>
                    </div>
                `;
                return;
            }

            // 创建简历卡片
            pageData.resumes.forEach(resume => {
                const card = createResumeCard(resume);
                container.appendChild(card);
            });
        }

        // 创建简历卡片
        function createResumeCard(resume) {
            const card = document.createElement('div');
            card.className = 'resume-card';

            // 计算学校徽章
            let schoolBadge = '';
            if (resume.is_985) {
                schoolBadge = '<span class="badge school-badge">985</span>';
            } else if (resume.is_211) {
                schoolBadge = '<span class="badge school-badge">211</span>';
            } else if (resume.is_double_top) {
                schoolBadge = '<span class="badge school-badge">双一流</span>';
            }

            // 计算工作经验徽章
            let expBadge = '';
            if (resume.years_of_exp > 0) {
                expBadge = `<span class="badge experience-badge">${resume.years_of_exp}年经验</span>`;
            } else {
                expBadge = '<span class="badge experience-badge">应届生</span>';
            }

            // 计算教育徽章
            let eduBadge = '';
            if (resume.highest_education && resume.highest_education !== '未知') {
                eduBadge = `<span class="badge education-badge">${resume.highest_education}</span>`;
            }

            // 生成标签
            let tags = '';
            if (resume.basic_info && resume.basic_info.tags) {
                const tagList = resume.basic_info.tags.split(',');
                tags = tagList.map(tag => `<span class="tag">${tag.trim()}</span>`).join('');
            }

            // 基本信息部分
            let basicInfoHTML = `
                <div class="info-row">
                    <div class="info-label">邮箱</div>
                    <div class="info-value">${resume.basic_info && resume.basic_info.email ? resume.basic_info.email : '未提供'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">电话</div>
                    <div class="info-value">${resume.basic_info && resume.basic_info.phone ? resume.basic_info.phone : '未提供'}</div>
                </div>
            `;

            // 简历块部分
            let chunksHTML = '';
            if (resume.chunks && resume.chunks.length > 0) {
                resume.chunks.forEach(chunk => {
                    // 确定块类型图标和样式
                    let chunkClass = '';
                    let chunkIcon = '';
                    
                    switch(chunk.chunk_type) {
                        case 'BASIC_INFO':
                            chunkIcon = '<i class="bi bi-person-vcard"></i>';
                            break;
                        case 'SKILLS':
                            chunkIcon = '<i class="bi bi-tools"></i>';
                            chunkClass = 'skill-chunk';
                            break;
                        case 'WORK_EXPERIENCE':
                            chunkIcon = '<i class="bi bi-briefcase"></i>';
                            chunkClass = 'work-chunk';
                            break;
                        case 'EDUCATION':
                            chunkIcon = '<i class="bi bi-mortarboard"></i>';
                            chunkClass = 'education-chunk';
                            break;
                        case 'PROJECTS':
                            chunkIcon = '<i class="bi bi-code-square"></i>';
                            chunkClass = 'project-chunk';
                            break;
                        case 'INTERNSHIPS':
                            chunkIcon = '<i class="bi bi-journal-code"></i>';
                            chunkClass = 'internship-chunk';
                            break;
                        case 'PORTFOLIO':
                            chunkIcon = '<i class="bi bi-file-earmark-code"></i>';
                            chunkClass = 'portfolio-chunk';
                            break;
                        default:
                            chunkIcon = '<i class="bi bi-file-text"></i>';
                    }

                    chunksHTML += `
                        <div class="chunk ${chunkClass}">
                            <div class="chunk-title">
                                <div class="chunk-icon">${chunkIcon}</div>
                                ${chunk.chunk_title}
                                <span class="chunk-type">${chunk.chunk_type}</span>
                            </div>
                            <div class="chunk-content">${chunk.content_text}</div>
                        </div>
                    `;
                });
            } else {
                chunksHTML = '<p class="text-muted">未提供简历内容块</p>';
            }

            // 构建卡片HTML
            card.innerHTML = `
                <div class="card-header">
                    <h2 class="candidate-name">
                        ${resume.candidate_name}
                        ${resume.years_of_exp >= 8 ? '<span class="badge-highlight">资深开发</span>' : ''}
                    </h2>
                    <div class="file-name">${resume.original_filename}</div>
                    <div class="badge-container">
                        ${expBadge}
                        ${eduBadge}
                        ${schoolBadge}
                    </div>
                    <div class="tags-container">
                        ${tags}
                    </div>
                </div>
                <div class="basic-info">
                    ${basicInfoHTML}
                </div>
                <div class="chunk-container">
                    ${chunksHTML}
                </div>
            `;

            return card;
        }

        // 更新分页控件状态
        function updatePaginationControls() {
            const prevButton = document.getElementById('prev-page');
            const nextButton = document.getElementById('next-page');

            // 更新上一页按钮状态
            if (currentPageIndex === 0) {
                prevButton.disabled = true;
                prevButton.classList.add('disabled');
            } else {
                prevButton.disabled = false;
                prevButton.classList.remove('disabled');
            }

            // 更新下一页按钮状态
            const currentData = allPagesData[currentPageIndex];
            const hasMorePages = currentData.cursor + currentData.size < currentData.total_count;
            const hasNextPageData = currentPageIndex < allPagesData.length - 1;

            if (!hasMorePages || !hasNextPageData) {
                nextButton.disabled = true;
                nextButton.classList.add('disabled');
            } else {
                nextButton.disabled = false;
                nextButton.classList.remove('disabled');
            }
        }

        // 上一页按钮事件处理
        document.getElementById('prev-page').addEventListener('click', function() {
            if (currentPageIndex > 0) {
                currentPageIndex--;
                displayResumes(allPagesData[currentPageIndex]);
                updatePaginationControls();
                window.scrollTo(0, 0);
            }
        });

        // 下一页按钮事件处理
        document.getElementById('next-page').addEventListener('click', function() {
            if (currentPageIndex < allPagesData.length - 1) {
                currentPageIndex++;
                displayResumes(allPagesData[currentPageIndex]);
                updatePaginationControls();
                window.scrollTo(0, 0);
            }
        });
    </script>
</body>
</html>